<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superstore Sales Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega/5.25.0/vega.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/5.15.1/vega-lite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/6.24.0/vega-embed.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        
        .filters-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }
        
        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            min-width: 150px;
        }
        
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .metric-card h3 {
            margin: 0 0 10px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .metric-card .value {
            font-size: 2em;
            font-weight: bold;
            margin: 0;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }
        
        .chart-full-width {
            grid-column: 1 / -1;
        }
        
        .insight-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .insight-panel.active {
            display: block;
        }
        
        .insight-panel h3 {
            margin-top: 0;
            color: #fff;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-section {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>Superstore Sales Overview</h1>
        </div>
        
        <div class="filters-section">
            <div class="filter-group">
                <label for="regionFilter">Region</label>
                <select id="regionFilter">
                    <option value="All">All Regions</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="categoryFilter">Category</label>
                <select id="categoryFilter">
                    <option value="All">All Categories</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="yearFilter">Year</label>
                <select id="yearFilter">
                    <option value="All">All Years</option>
                </select>
            </div>
        </div>
        
        <div class="metrics-row">
            <div class="metric-card">
                <h3>Total Sales</h3>
                <p class="value" id="totalSales">$0</p>
            </div>
            <div class="metric-card">
                <h3>Total Profit</h3>
                <p class="value" id="totalProfit">$0</p>
            </div>
            <div class="metric-card">
                <h3>Total Orders</h3>
                <p class="value" id="totalOrders">0</p>
            </div>
            <div class="metric-card">
                <h3>Profit Margin</h3>
                <p class="value" id="profitMargin">0%</p>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">Sales by Region</div>
                <div id="salesByRegion"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Sales by Category</div>
                <div id="salesByCategory"></div>
            </div>
            <div class="chart-container chart-full-width">
                <div class="chart-title">Sales Trend Over Time</div>
                <div id="salesTrend"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Profit vs Sales by Sub-Category</div>
                <div id="profitVsSales"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Top 10 States by Sales</div>
                <div id="topStates"></div>
            </div>
        </div>
        
        <div class="insight-panel" id="insightPanel">
            <h3>AI Insights</h3>
            <p id="insightText">Click on any chart element to get AI-powered insights about your selection.</p>
        </div>
    </div>

    <script>
        class SuperstoreDashboard {
            constructor() {
                this.data = [];
                this.filteredData = [];
                this.charts = {};
                this.filters = {
                    region: 'All',
                    category: 'All',
                    year: 'All'
                };
                
                this.init();
            }
            
            async init() {
                await this.generateSampleData();
                this.setupFilters();
                this.updateDashboard();
            }
            
            async generateSampleData() {
                // Generate sample data similar to Superstore dataset
                const regions = ['East', 'West', 'Central', 'South'];
                const categories = ['Furniture', 'Office Supplies', 'Technology'];
                const subCategories = {
                    'Furniture': ['Chairs', 'Tables', 'Bookcases', 'Furnishings'],
                    'Office Supplies': ['Paper', 'Binders', 'Storage', 'Art', 'Labels', 'Envelopes', 'Fasteners', 'Supplies'],
                    'Technology': ['Phones', 'Accessories', 'Copiers', 'Machines']
                };
                const states = ['California', 'New York', 'Texas', 'Washington', 'Pennsylvania', 'Illinois', 'Ohio', 'Florida', 'North Carolina', 'Virginia', 'Michigan', 'Indiana', 'Tennessee', 'Georgia', 'Colorado', 'Arizona', 'Maryland', 'Minnesota', 'Wisconsin', 'Oregon'];
                
                const data = [];
                const startDate = new Date('2020-01-01');
                const endDate = new Date('2023-12-31');
                
                for (let i = 0; i < 10000; i++) {
                    const region = regions[Math.floor(Math.random() * regions.length)];
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    const subCategory = subCategories[category][Math.floor(Math.random() * subCategories[category].length)];
                    const state = states[Math.floor(Math.random() * states.length)];
                    
                    const orderDate = new Date(startDate.getTime() + Math.random() * (endDate.getTime() - startDate.getTime()));
                    const sales = Math.random() * 10000 + 100;
                    const profitMargin = (Math.random() * 0.4) - 0.1; // -10% to 30%
                    const profit = sales * profitMargin;
                    const quantity = Math.floor(Math.random() * 20) + 1;
                    
                    data.push({
                        orderId: `US-${i.toString().padStart(7, '0')}`,
                        orderDate: orderDate,
                        year: orderDate.getFullYear(),
                        month: orderDate.getMonth() + 1,
                        region: region,
                        state: state,
                        category: category,
                        subCategory: subCategory,
                        sales: Math.round(sales * 100) / 100,
                        profit: Math.round(profit * 100) / 100,
                        quantity: quantity
                    });
                }
                
                this.data = data;
                this.filteredData = [...data];
            }
            
            setupFilters() {
                // Populate filter dropdowns
                const regions = [...new Set(this.data.map(d => d.region))].sort();
                const categories = [...new Set(this.data.map(d => d.category))].sort();
                const years = [...new Set(this.data.map(d => d.year))].sort();
                
                this.populateSelect('regionFilter', regions);
                this.populateSelect('categoryFilter', categories);
                this.populateSelect('yearFilter', years);
                
                // Add event listeners
                document.getElementById('regionFilter').addEventListener('change', (e) => {
                    this.filters.region = e.target.value;
                    this.updateDashboard();
                });
                
                document.getElementById('categoryFilter').addEventListener('change', (e) => {
                    this.filters.category = e.target.value;
                    this.updateDashboard();
                });
                
                document.getElementById('yearFilter').addEventListener('change', (e) => {
                    this.filters.year = e.target.value;
                    this.updateDashboard();
                });
            }
            
            populateSelect(elementId, options) {
                const select = document.getElementById(elementId);
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                });
            }
            
            applyFilters() {
                this.filteredData = this.data.filter(d => {
                    return (this.filters.region === 'All' || d.region === this.filters.region) &&
                           (this.filters.category === 'All' || d.category === this.filters.category) &&
                           (this.filters.year === 'All' || d.year.toString() === this.filters.year);
                });
            }
            
            updateMetrics() {
                const totalSales = this.filteredData.reduce((sum, d) => sum + d.sales, 0);
                const totalProfit = this.filteredData.reduce((sum, d) => sum + d.profit, 0);
                const totalOrders = this.filteredData.length;
                const profitMargin = totalSales > 0 ? (totalProfit / totalSales) * 100 : 0;
                
                document.getElementById('totalSales').textContent = `$${this.formatNumber(totalSales)}`;
                document.getElementById('totalProfit').textContent = `$${this.formatNumber(totalProfit)}`;
                document.getElementById('totalOrders').textContent = this.formatNumber(totalOrders);
                document.getElementById('profitMargin').textContent = `${profitMargin.toFixed(1)}%`;
            }
            
            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                } else {
                    return num.toFixed(0);
                }
            }
            
            async createSalesByRegionChart() {
                const salesByRegion = this.aggregateData(this.filteredData, 'region', 'sales');
                
                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": {
                        "values": salesByRegion
                    },
                    "mark": {
                        "type": "bar",
                        "color": "#667eea",
                        "cursor": "pointer"
                    },
                    "encoding": {
                        "x": {
                            "field": "region",
                            "type": "nominal",
                            "axis": {"title": "Region", "labelAngle": 0}
                        },
                        "y": {
                            "field": "sales",
                            "type": "quantitative",
                            "axis": {"title": "Sales ($)"}
                        },
                        "tooltip": [
                            {"field": "region", "type": "nominal", "title": "Region"},
                            {"field": "sales", "type": "quantitative", "title": "Sales", "format": "$,.0f"}
                        ]
                    },
                    "width": 300,
                    "height": 200
                };
                
                const result = await vegaEmbed('#salesByRegion', spec, {actions: false});
                result.view.addEventListener('click', (event, item) => {
                    if (item && item.datum) {
                        this.showInsight('region', item.datum.region, item.datum.sales);
                    }
                });
            }
            
            async createSalesByCategoryChart() {
                const salesByCategory = this.aggregateData(this.filteredData, 'category', 'sales');
                
                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": {
                        "values": salesByCategory
                    },
                    "mark": {
                        "type": "arc",
                        "innerRadius": 50,
                        "cursor": "pointer"
                    },
                    "encoding": {
                        "theta": {
                            "field": "sales",
                            "type": "quantitative"
                        },
                        "color": {
                            "field": "category",
                            "type": "nominal",
                            "scale": {"range": ["#667eea", "#764ba2", "#f093fb"]}
                        },
                        "tooltip": [
                            {"field": "category", "type": "nominal", "title": "Category"},
                            {"field": "sales", "type": "quantitative", "title": "Sales", "format": "$,.0f"}
                        ]
                    },
                    "width": 250,
                    "height": 200
                };
                
                const result = await vegaEmbed('#salesByCategory', spec, {actions: false});
                result.view.addEventListener('click', (event, item) => {
                    if (item && item.datum) {
                        this.showInsight('category', item.datum.category, item.datum.sales);
                    }
                });
            }
            
            async createSalesTrendChart() {
                const salesTrend = this.aggregateByMonthYear(this.filteredData);
                
                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": {
                        "values": salesTrend
                    },
                    "mark": {
                        "type": "line",
                        "point": true,
                        "color": "#667eea",
                        "strokeWidth": 3
                    },
                    "encoding": {
                        "x": {
                            "field": "date",
                            "type": "temporal",
                            "axis": {"title": "Date"}
                        },
                        "y": {
                            "field": "sales",
                            "type": "quantitative",
                            "axis": {"title": "Sales ($)"}
                        },
                        "tooltip": [
                            {"field": "date", "type": "temporal", "title": "Date"},
                            {"field": "sales", "type": "quantitative", "title": "Sales", "format": "$,.0f"}
                        ]
                    },
                    "width": 600,
                    "height": 200
                };
                
                const result = await vegaEmbed('#salesTrend', spec, {actions: false});
                result.view.addEventListener('click', (event, item) => {
                    if (item && item.datum) {
                        this.showInsight('trend', item.datum.date, item.datum.sales);
                    }
                });
            }
            
            async createProfitVsSalesChart() {
                const profitVsSales = this.aggregateData(this.filteredData, 'subCategory', 'sales', 'profit');
                
                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": {
                        "values": profitVsSales
                    },
                    "mark": {
                        "type": "circle",
                        "size": 100,
                        "cursor": "pointer"
                    },
                    "encoding": {
                        "x": {
                            "field": "sales",
                            "type": "quantitative",
                            "axis": {"title": "Sales ($)"}
                        },
                        "y": {
                            "field": "profit",
                            "type": "quantitative",
                            "axis": {"title": "Profit ($)"}
                        },
                        "color": {
                            "field": "profit",
                            "type": "quantitative",
                            "scale": {"range": ["#ff6b6b", "#4ecdc4", "#45b7d1"]},
                            "legend": {"title": "Profit"}
                        },
                        "tooltip": [
                            {"field": "subCategory", "type": "nominal", "title": "Sub-Category"},
                            {"field": "sales", "type": "quantitative", "title": "Sales", "format": "$,.0f"},
                            {"field": "profit", "type": "quantitative", "title": "Profit", "format": "$,.0f"}
                        ]
                    },
                    "width": 300,
                    "height": 200
                };
                
                const result = await vegaEmbed('#profitVsSales', spec, {actions: false});
                result.view.addEventListener('click', (event, item) => {
                    if (item && item.datum) {
                        this.showInsight('subcategory', item.datum.subCategory, item.datum.sales, item.datum.profit);
                    }
                });
            }
            
            async createTopStatesChart() {
                const salesByState = this.aggregateData(this.filteredData, 'state', 'sales');
                const topStates = salesByState.sort((a, b) => b.sales - a.sales).slice(0, 10);
                
                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": {
                        "values": topStates
                    },
                    "mark": {
                        "type": "bar",
                        "color": "#764ba2",
                        "cursor": "pointer"
                    },
                    "encoding": {
                        "y": {
                            "field": "state",
                            "type": "nominal",
                            "sort": "-x",
                            "axis": {"title": "State"}
                        },
                        "x": {
                            "field": "sales",
                            "type": "quantitative",
                            "axis": {"title": "Sales ($)"}
                        },
                        "tooltip": [
                            {"field": "state", "type": "nominal", "title": "State"},
                            {"field": "sales", "type": "quantitative", "title": "Sales", "format": "$,.0f"}
                        ]
                    },
                    "width": 300,
                    "height": 200
                };
                
                const result = await vegaEmbed('#topStates', spec, {actions: false});
                result.view.addEventListener('click', (event, item) => {
                    if (item && item.datum) {
                        this.showInsight('state', item.datum.state, item.datum.sales);
                    }
                });
            }
            
            aggregateData(data, groupBy, sumField, sumField2 = null) {
                const grouped = {};
                
                data.forEach(d => {
                    const key = d[groupBy];
                    if (!grouped[key]) {
                        grouped[key] = { [groupBy]: key, [sumField]: 0 };
                        if (sumField2) grouped[key][sumField2] = 0;
                    }
                    grouped[key][sumField] += d[sumField];
                    if (sumField2) grouped[key][sumField2] += d[sumField2];
                });
                
                return Object.values(grouped);
            }
            
            aggregateByMonthYear(data) {
                const grouped = {};
                
                data.forEach(d => {
                    const date = new Date(d.year, d.month - 1, 1);
                    const key = date.toISOString().substring(0, 7);
                    if (!grouped[key]) {
                        grouped[key] = { date: date, sales: 0 };
                    }
                    grouped[key].sales += d.sales;
                });
                
                return Object.values(grouped).sort((a, b) => a.date - b.date);
            }
            
            showInsight(type, value, sales, profit = null) {
                const panel = document.getElementById('insightPanel');
                const text = document.getElementById('insightText');
                
                let insight = '';
                const totalSales = this.filteredData.reduce((sum, d) => sum + d.sales, 0);
                const percentage = ((sales / totalSales) * 100).toFixed(1);
                
                switch (type) {
                    case 'region':
                        insight = `<strong>${value}</strong> region accounts for <strong>${percentage}%</strong> of total sales ($${this.formatNumber(sales)}). `;
                        if (percentage > 30) {
                            insight += 'This is a dominant market that should receive continued investment and attention.';
                        } else if (percentage < 15) {
                            insight += 'This region shows potential for growth and may benefit from targeted marketing campaigns.';
                        } else {
                            insight += 'This region represents a solid market segment with balanced performance.';
                        }
                        break;
                        
                    case 'category':
                        insight = `<strong>${value}</strong> category generates <strong>${percentage}%</strong> of total sales ($${this.formatNumber(sales)}). `;
                        insight += 'Consider analyzing sub-categories within this segment for optimization opportunities.';
                        break;
                        
                    case 'subcategory':
                        const profitMargin = profit && sales > 0 ? ((profit / sales) * 100).toFixed(1) : 0;
                        insight = `<strong>${value}</strong> sub-category has sales of $${this.formatNumber(sales)} with a profit margin of <strong>${profitMargin}%</strong>. `;
                        if (profitMargin > 20) {
                            insight += 'Excellent profitability! Consider expanding this product line.';
                        } else if (profitMargin < 5) {
                            insight += 'Low profitability may indicate pricing or cost optimization opportunities.';
                        } else {
                            insight += 'Moderate profitability with potential for improvement through operational efficiency.';
                        }
                        break;
                        
                    case 'state':
                        insight = `<strong>${value}</strong> contributes <strong>${percentage}%</strong> of total sales ($${this.formatNumber(sales)}). `;
                        insight += 'This state represents a key market in the selected region and time period.';
                        break;
                        
                    case 'trend':
                        const date = new Date(value).toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                        insight = `In <strong>${date}</strong>, sales reached $${this.formatNumber(sales)}. `;
                        insight += 'Analyze seasonal patterns and external factors that may have influenced this performance.';
                        break;
                        
                    default:
                        insight = 'Click on any chart element to get detailed insights about your data selection.';
                }
                
                text.innerHTML = insight;
                panel.classList.add('active');
            }
            
            async updateDashboard() {
                this.applyFilters();
                this.updateMetrics();
                
                // Update all charts
                await Promise.all([
                    this.createSalesByRegionChart(),
                    this.createSalesByCategoryChart(),
                    this.createSalesTrendChart(),
                    this.createProfitVsSalesChart(),
                    this.createTopStatesChart()
                ]);
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SuperstoreDashboard();
        });
    </script>
</body>
</html>